#!/bin/sh

# MPV
# Simon Hugh Moore
#
# Wrapper script for mpv to have a persistent profile state.
# Use mpv -P to choose profile.

# mpv runtime dir.
runtime_dir=$XDG_RUNTIME_DIR/mpv
# file to store profile to run.
profile=$runtime_dir/profile

# create runtime dir
mkdir -p "$runtime_dir"
# create profile file
touch -a "$profile"

# Run mpv with profile
_mpvp(){ /usr/bin/mpv --profile=$1 $@; }

# get profile choice and write in file.
_choose_profile() {
    _mpvp help | awk 'NR>1 {print $1}' | fzf > "$profile"
}

# read profile file and run apropriate profile with mpv
_mpv(){ _mpvp $(head -n 1 $profile) $@; }

# run mpv -P to choose profile with fzf
case $1 in
    -P) _choose_profile ;;
    *) _mpv $@ ;;
esac
