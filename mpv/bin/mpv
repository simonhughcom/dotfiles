#!/bin/sh

# MPV
# Simon Hugh Moore
#
# Wrapper script for mpv to have a persistent profile state.
# Use mpv -P to choose profile.

# mpv runtime dir.
runtime_dir=$XDG_RUNTIME_DIR/mpv
# file to store profile to run.
profile=$runtime_dir/profile

# create runtime dir
mkdir -p "$runtime_dir"
# create profile file
touch -a "$profile"

# mpv wrapper
_mpv(){ /usr/bin/mpv $@; }

# get profile choice and write in file.
_choose_profile() {
    _mpv --profile=help | awk 'NR>1 {print $1}' | fzf > "$profile"
}

# read profile file and run apropriate profile with mpv
_mpvp(){
    pf=$(head -n 1 $profile)
    echo "Running with profile: $pf"
    [ -z "$pf" ] && _mpv $@ || _mpv --profile=$pf $@
}

# run mpv -P to choose profile with fzf
case $1 in
    -P) _choose_profile ;;
    *) _mpvp $@ ;;
esac
