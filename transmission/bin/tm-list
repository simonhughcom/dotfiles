#!/bin/sh

# TM-LIST
# Simon Hugh Moore
#
# Filter transmission list in various ways.


help="$(basename "$0") -- list torrents in transmission.

where:
    stopped|s*       list stopped torrents.
    down|d*          list downloading torrents.
    up|u*            list uploading/seeding torrents.
    complete|c*      list complete torrents (100%).
    finished|f*      list finished torrents.
    help|h*          show this help message.

    Use ! after any command to negate the list.
"

# preprocess torrent-list
_tl() { transmission-remote -l | sed 's/^[ \t]\+//g'; }

# filter torrent list.
# Use: _filter_list "column number" "expression" "!"
_filter_list() {
    eval  "_tl | awk -F'[[:space:]][[:space:]]+' 'NR==1 || \$$1 $3~ \"$2\"'" 
}

[ -n "$2" ] && [ "$2" != "!" ] && { echo "Use: $(basename "$0") COMMAND [!]"; return 1; }

case "$1" in
    s*) _filter_list "8" "Stopped" "$2" ;;
    d*) _filter_list "8" "Downloading|Up & Down" "$2";;
    u*) _filter_list "8" "Seeding" "$2" ;;
    c*) _filter_list "2" "100%" "$2";;
    f*) _filter_list "8" "Idle|Seeding" "$2" ;;
    h*) echo "$help" ;;
    *|all|a) _tl  ;;
 esac
