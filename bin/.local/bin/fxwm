#!/bin/sh

# FXWM
# Simon Hugh Moore
#
# A psudo window manager using fzf
# Switch, move and delete windows, desktops and monitors

_dependency(){ command -v "$1" > /dev/null || { echo "error: "$1" not found"; exit 1; }; }
_dependency "wmctrl"
_dependency "xrandr"

_window(){
    windows="$( wmctrl -l -pG )"

    if [ "$1" = "-c" ]; then
        current_desktop="$( wmctrl -d | grep '*' | cut -d' ' -f1 )"
        windows="$( echo "$windows" | grep "^0x[^ ]*[[:space:]][[:space:]]*$current_desktop[[:space:]].*$" )"
    fi

    choice="$( echo "$windows" | fzf --with-nth=9.. --expect='alt-q,alt-m,alt-t' )"
    key="$( echo "$choice" | head -n1 )"
    window="$( echo "$choice" | tail -n1 )"

    case "$key" in
        alt-q) wmctrl -ic "$window" ;;
        alt-m) wmctrl -iR "$window" ;;
        alt-t) wmctrl -ir "$window" -T "$( echo "" | fzf --print-query --prompt="Title: " --pointer=" " )" ;;
        *) wmctrl -ia "$window" ;;
    esac
}

# TODO: Add delete and move commands
_desktop(){
    choice="$( wmctrl -d | fzf --with-nth=9 )"
    wmctrl -s "$choice"
}

# TODO: present list of monitors in fzf
_monitor(){
    xrandr --listmonitors
}

case "$1" in
    window) shift; _window "$@" ;;
    desktop) shift; _desktop "$@" ;;
    monitor) shift; _monitor "$@" ;;
esac
